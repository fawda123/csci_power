sapply(fls, source)
# raw <- read_excel("ignore/csci_raw.xlsx")
# save(raw, file = 'data/raw.RData', compress = 'xz')
data(raw)
# format raw data for power analysis, CSCI
topow <- raw %>%
select(MasterID, FieldReplicate, SampleYear, CSCI) %>%
filter(SampleYear >= 2008) %>%
filter(!is.na(CSCI)) %>%
mutate(SampleYear = as.character(SampleYear))
# tmp <- topow %>%
#   group_by(MasterID) %>%
#   mutate(n = n())
#
# ggplot(tmp, aes(x = n)) +
#   geom_bar()
##
# input for function
# indicator name
indicator <- 'CSCI'
# mean of indicator
indic.mean <- topow$CSCI %>%
mean(na.rm = T)
# power to detect trend of x percent
trend <- 2
# nsites - number of sites visited each year
# a matrix where number of rows is number of rows is number of indicators
# number of columns is number of years
# each cell is number of sites to visit in a year
# this is 30 sites visited every year
# skipped years should be zero
nyr <- 38 # up to 2050
nsites <- matrix(rep(30, nyr), nrow = 1, ncol = nyr)
# number of repeats per year (one)
nrepeats <- 1
##
# variance components of sites
mod <- lme(CSCI ~ SampleYear, random = ~ 1 | MasterID, data = topow)
tot.var <- var(topow$CSCI)
year.var <- mod$sigma^2
index.var <- var(resid(mod))
site.var <- tot.var - year.var - index.var
power.fcn(indicator = "CSCI",
ind.mean = 1,
trend = 2,
nsites = nsites,
nrepeats = 1,
site.var = site.var,
year.var = year.var,
siteyear.var = 0,
index.var = index.var,
site.rho = 1,
year.rho = 0,
alfa = 0.05,
plot.ind = TRUE)
power.fcn(indicator = "CSCI",
ind.mean = 1,
trend = 10,
nsites = nsites,
nrepeats = 1,
site.var = site.var,
year.var = year.var,
siteyear.var = 0,
index.var = index.var,
site.rho = 1,
year.rho = 0,
alfa = 0.05,
plot.ind = TRUE)
power.fcn(indicator = "CSCI",
ind.mean = 1,
trend = 1,
nsites = nsites,
nrepeats = 1,
site.var = site.var,
year.var = year.var,
siteyear.var = 0,
index.var = index.var,
site.rho = 1,
year.rho = 0,
alfa = 0.05,
plot.ind = TRUE)
nsites
range(topow$SampleYear)
power.fcn(indicator = "CSCI",
ind.mean = ind.mean,
trend = trend,
nsites = nsites,
nrepeats = 1,
site.var = site.var,
year.var = year.var,
siteyear.var = 0,
index.var = index.var,
site.rho = 1,
year.rho = 0,
alfa = 0.05,
plot.ind = TRUE)
library(tidyverse)
library(readxl)
library(nlme)
fls <- list.files('R', full.names = T)
sapply(fls, source)
# raw <- read_excel("ignore/csci_raw.xlsx")
# save(raw, file = 'data/raw.RData', compress = 'xz')
data(raw)
# format raw data for power analysis, CSCI
topow <- raw %>%
select(MasterID, FieldReplicate, SampleYear, CSCI) %>%
filter(SampleYear >= 2008) %>%
filter(!is.na(CSCI)) %>%
mutate(SampleYear = as.character(SampleYear))
# tmp <- topow %>%
#   group_by(MasterID) %>%
#   mutate(n = n())
#
# ggplot(tmp, aes(x = n)) +
#   geom_bar()
##
# input for function
# indicator name
indicator <- 'CSCI'
# mean of indicator
ind.mean <- topow$CSCI %>%
mean(na.rm = T)
# power to detect trend of x percent
trend <- 2
# nsites - number of sites visited each year
# a matrix where number of rows is number of rows is number of indicators
# number of columns is number of years
# each cell is number of sites to visit in a year
# this is 30 sites visited every year
# skipped years should be zero
nyr <- 38 # up to 2050
nsites <- matrix(rep(30, nyr), nrow = 1, ncol = nyr)
# number of repeats per year (one)
nrepeats <- 1
##
# variance components of sites
mod <- lme(CSCI ~ SampleYear, random = ~ 1 | MasterID, data = topow)
tot.var <- var(topow$CSCI)
year.var <- mod$sigma^2
index.var <- var(resid(mod))
site.var <- tot.var - year.var - index.var
power.fcn(indicator = "CSCI",
ind.mean = ind.mean,
trend = trend,
nsites = nsites,
nrepeats = 1,
site.var = site.var,
year.var = year.var,
siteyear.var = 0,
index.var = index.var,
site.rho = 1,
year.rho = 0,
alfa = 0.05,
plot.ind = TRUE)
power.fcn(indicator = "CSCI",
ind.mean = ind.mean,
trend = trend,
nsites = nsites,
nrepeats = 1,
site.var = site.var,
year.var = year.var,
siteyear.var = 2,
index.var = index.var,
site.rho = 1,
year.rho = 0,
alfa = 0.05,
plot.ind = TRUE)
power.fcn(indicator = "CSCI",
ind.mean = ind.mean,
trend = trend,
nsites = nsites,
nrepeats = 1,
site.var = site.var,
year.var = year.var,
siteyear.var = 0,
index.var = index.var,
site.rho = 1,
year.rho = 0,
alfa = 0.05,
plot.ind = TRUE)
power.fcn(indicator = "CSCI",
ind.mean = ind.mean,
trend = trend,
nsites = nsites,
nrepeats = 1,
site.var = site.var,
year.var = year.var,
siteyear.var = 0.1,
index.var = index.var,
site.rho = 1,
year.rho = 0,
alfa = 0.05,
plot.ind = TRUE)
n sites
nsites
rep(c(60, 0), nyr)
nsites2 <- matrix(rep(c(60, 0), nyr), nrow = 1, ncol = nyr)
nsites2
2016 + 38
nsites <- rbind(nsites1, nsites2, nsites3, nsites4)
nsites1 <- matrix(rep(30, nyr), nrow = 1, ncol = nyr)
nsites2 <- matrix(rep(c(60, 0), nyr), nrow = 1, ncol = nyr)
nsites3 <- matrix(rep(c(30, 0), nyr), nrow = 1, ncol = nyr)
nsites4 <- matrix(rep(c(15, 0), nyr), nrow = 1, ncol = nyr)
nsites <- rbind(nsites1, nsites2, nsites3, nsites4)
nsites
power.fcn(indicator = "CSCI",
ind.mean = ind.mean,
trend = trend,
nsites = nsites,
nrepeats = 1,
site.var = site.var,
year.var = year.var,
siteyear.var = 0,
index.var = index.var,
site.rho = 1,
year.rho = 0,
alfa = 0.05,
plot.ind = TRUE)
power.fcn(indicator = c('a', 'b', 'c', 'd'),
ind.mean = ind.mean,
trend = trend,
nsites = nsites,
nrepeats = 1,
site.var = site.var,
year.var = year.var,
siteyear.var = 0,
index.var = index.var,
site.rho = 1,
year.rho = 0,
alfa = 0.05,
plot.ind = TRUE)
nsites
power.fcn(indicator = c('a', 'b', 'c', 'd'),
ind.mean = rep(ind.mean, 4),
trend = trend,
nsites = nsites,
nrepeats = 1,
site.var = site.var,
year.var = year.var,
siteyear.var = 0,
index.var = index.var,
site.rho = 1,
year.rho = 0,
alfa = 0.05,
plot.ind = TRUE)
power.fcn(indicator = 'CSCI',
ind.mean = ind.mean,
trend = trend,
nsites = nsites,
nrepeats = 1,
site.var = site.var,
year.var = year.var,
siteyear.var = 0,
index.var = index.var,
site.rho = 1,
year.rho = 0,
alfa = 0.05,
plot.ind = F)
power.fcn(indicator = 'CSCI',
ind.mean = ind.mean,
trend = trend,
nsites = nsites1,
nrepeats = 1,
site.var = site.var,
year.var = year.var,
siteyear.var = 0,
index.var = index.var,
site.rho = 1,
year.rho = 0,
alfa = 0.05,
plot.ind = T)
power.fcn(indicator = 'CSCI',
ind.mean = ind.mean,
trend = trend,
nsites = nsites2,
nrepeats = 1,
site.var = site.var,
year.var = year.var,
siteyear.var = 0,
index.var = index.var,
site.rho = 1,
year.rho = 0,
alfa = 0.05,
plot.ind = T)
nsites2
power.fcn(indicator = 'CSCI',
ind.mean = ind.mean,
trend = trend,
nsites = nsites3,
nrepeats = 1,
site.var = site.var,
year.var = year.var,
siteyear.var = 0,
index.var = index.var,
site.rho = 1,
year.rho = 0,
alfa = 0.05,
plot.ind = T)
nsites1 <- matrix(rep(60, nyr), nrow = 1, ncol = nyr)
power.fcn(indicator = 'CSCI',
ind.mean = ind.mean,
trend = trend,
nsites = nsites1,
nrepeats = 1,
site.var = site.var,
year.var = year.var,
siteyear.var = 0,
index.var = index.var,
site.rho = 1,
year.rho = 0,
alfa = 0.05,
plot.ind = T)
power.fcn(indicator = 'CSCI',
ind.mean = ind.mean,
trend = trend,
nsites = nsites1,
nrepeats = rep(c(1, 0), nyr),
site.var = site.var,
year.var = year.var,
siteyear.var = 0,
index.var = index.var,
site.rho = 1,
year.rho = 0,
alfa = 0.05,
plot.ind = T)
rep(c(1, 0), nyr)
rep(c(1, 0), nyr) %>% length
nyr
nsites1 <- matrix(rep(60, nyr), nrow = 1, ncol = nyr)
nsites2 <- matrix(rep(c(60, 0), times = nyr), nrow = 1, ncol = nyr)
nsites3 <- matrix(rep(c(30, 0), times = nyr), nrow = 1, ncol = nyr)
nsites4 <- matrix(rep(c(15, 0), times = nyr), nrow = 1, ncol = nyr)
# number of repeats per year (one)
nrepeats <- 1
dim(nsites)
power.fcn(indicator = 'CSCI',
ind.mean = ind.mean,
trend = trend,
nsites = nsites,
nrepeats = 1, #rep(c(1, 0), nyr),
site.var = site.var,
year.var = year.var,
siteyear.var = 0,
index.var = index.var,
site.rho = 1,
year.rho = 0,
alfa = 0.05,
plot.ind = T)
power.fcn(indicator = c('a', 'b', 'c', 'd'), #CSCI',
ind.mean = ind.mean,
trend = trend,
nsites = nsites,
nrepeats = 1, #rep(c(1, 0), nyr),
site.var = site.var,
year.var = year.var,
siteyear.var = 0,
index.var = index.var,
site.rho = 1,
year.rho = 0,
alfa = 0.05,
plot.ind = T)
rep(c(1, 0), times = nyr/2)
rep(c(1, 0), times = nyr/2) %>% length
power.fcn(indicator = 'CSCI',
ind.mean = ind.mean,
trend = trend,
nsites = nsites1,
nrepeats = rep(c(1, 0), times = nyr/2),
site.var = site.var,
year.var = year.var,
siteyear.var = 0,
index.var = index.var,
site.rho = 1,
year.rho = 0,
alfa = 0.05,
plot.ind = T)
power.fcn(indicator = 'CSCI',
ind.mean = ind.mean,
trend = trend,
nsites = nsites1,
nrepeats = rep(c(1, 0, 0, 0), times = nyr/4),
site.var = site.var,
year.var = year.var,
siteyear.var = 0,
index.var = index.var,
site.rho = 1,
year.rho = 0,
alfa = 0.05,
plot.ind = T)
rep(c(1, 0, 0, 0), times = nyr/4)
rep(c(1, 0, 0, 0), times = nyr/4) %>% length
nsites2 <- matrix(rep(c(60, 0), times = nyr), nrow = 1, ncol = nyr)
nsites2
power.fcn(indicator = 'CSCI',
ind.mean = ind.mean,
trend = trend,
nsites = nsites2,
nrepeats = 1,
site.var = site.var,
year.var = year.var,
siteyear.var = 0,
index.var = index.var,
site.rho = 1,
year.rho = 0,
alfa = 0.05,
plot.ind = T)
nsites2
nsites2 <- matrix(rep(c(60, 1), times = nyr), nrow = 1, ncol = nyr)
nsites2
power.fcn(indicator = 'CSCI',
ind.mean = ind.mean,
trend = trend,
nsites = nsites2,
nrepeats = 1,
site.var = site.var,
year.var = year.var,
siteyear.var = 0,
index.var = index.var,
site.rho = 1,
year.rho = 0,
alfa = 0.05,
plot.ind = T)
nsites2 <- matrix(rep(c(30, 1), times = nyr), nrow = 1, ncol = nyr)
power.fcn(indicator = 'CSCI',
ind.mean = ind.mean,
trend = trend,
nsites = nsites2,
nrepeats = 1,
site.var = site.var,
year.var = year.var,
siteyear.var = 0,
index.var = index.var,
site.rho = 1,
year.rho = 0,
alfa = 0.05,
plot.ind = T)
nsites4 <- matrix(rep(c(15, 1), times = nyr), nrow = 1, ncol = nyr)
power.fcn(indicator = 'CSCI',
ind.mean = ind.mean,
trend = trend,
nsites = nsites4,
nrepeats = 1,
site.var = site.var,
year.var = year.var,
siteyear.var = 0,
index.var = index.var,
site.rho = 1,
year.rho = 0,
alfa = 0.05,
plot.ind = T)
nsites4 <- matrix(rep(c(1, 1), times = nyr), nrow = 1, ncol = nyr)
power.fcn(indicator = 'CSCI',
ind.mean = ind.mean,
trend = trend,
nsites = nsites4,
nrepeats = 1,
site.var = site.var,
year.var = year.var,
siteyear.var = 0,
index.var = index.var,
site.rho = 1,
year.rho = 0,
alfa = 0.05,
plot.ind = T)
power.fcn(indicator = 'CSCI',
ind.mean = ind.mean,
trend = trend,
nsites = nsites4,
nrepeats = 1,
site.var = site.var,
year.var = year.var,
siteyear.var = 0,
index.var = index.var,
site.rho = .5,
year.rho = 0,
alfa = 0.05,
plot.ind = T)
ind.mean
matrix(rep(50, 20), nrow=1
)
matrix(rep(c(50, 0), times = 10), nrow = 1, ncol = nyr)
matrix(rep(c(50, 0), times = 10), nrow = 1, ncol = 20)
matrix(rep(c(50, 0), times = 10), nrow = 1, ncol = 20)
nsites2 <- matrix(rep(c(50, 0), times = 10), nrow = 1, ncol = 20)
power.fcn(indicator = 'CSCI',
ind.mean = ind.mean,
trend = trend,
nsites = nsites2,
nrepeats = 1,
site.var = site.var,
year.var = year.var,
siteyear.var = 0,
index.var = index.var,
site.rho = 1,
year.rho = 0,
alfa = 0.05,
plot.ind = T)
data(raw)
dim(raw)
View(raw)
range(raw$SampleYear    )
range(raw$SampleYear, na.rm = T)
hist(raw$SampleYear, na.rm = T)
raw <- raw %>%
filter(SampleYear >= 2000)
library(tidyverse)
raw <- raw %>%
filter(SampleYear >= 2000)
length(unique(raw$MasterID))
dim(raw)
